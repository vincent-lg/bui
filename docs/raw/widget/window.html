<!DOCTYPE html>
<html lang="en-US">
  <head>
   <meta charset="UTF-8">
    <title>Blind User Interface - widget/window.py</title>
    <meta name="generator" content="Jekyll v3.8.5" />
    <meta property="og:title" content="widget/window.py" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="widget/window.py" />
    <meta property="og:description" content="widget/window.py" />
    <link rel="canonical" href="https://vincent-lg.github.io/bui/widget/window.html" />
    <meta property="og:url" content="https://vincent-lg.github.io/bui/widget/window.html" />
    <meta property="og:site_name" content="bui" />
    <script type="application/ld+json">
    {"@type":"WebSite","headline":"Blind User Interface - widget/window.py","url":"https://vincent-lg.github.io/bui/widget/window.html","name":"widget/window.py","description":"widget/window.py","@context":"http://schema.org"}</script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/bui/assets/css/style.css?v=1c99addae22d0f201ec863ee092d1195efd935b8">
  </head>
  <body>
    <div>
      <span style="white-space: pre;"><a id="L1"></a>&quot;&quot;&quot;The Window class.</span><br />
      <span style="white-space: pre;"><a id="L2"></a></span><br />
      <span style="white-space: pre;"><a id="L3"></a>This class is the main graphical content of any window.  With</span><br />
      <span style="white-space: pre;"><a id="L4"></a>[Dialog](dialog.md), chances are you won&#x27;t need anything else as a</span><br />
      <span style="white-space: pre;"><a id="L5"></a>container for your windows.</span><br />
      <span style="white-space: pre;"><a id="L6"></a></span><br />
      <span style="white-space: pre;"><a id="L7"></a>The Window class contains the controls of your window, as user-defined</span><br />
      <span style="white-space: pre;"><a id="L8"></a>methods prefixed with `on`..  It can also contain data models and controls</span><br />
      <span style="white-space: pre;"><a id="L9"></a>of the contained widgets (graphical elements) in this window.  Optionally,</span><br />
      <span style="white-space: pre;"><a id="L10"></a>it can contain the window layout, though it&#x27;s recommended to place this</span><br />
      <span style="white-space: pre;"><a id="L11"></a>layout in a separate [file](../layout/file.md).</span><br />
      <span style="white-space: pre;"><a id="L12"></a></span><br />
      <span style="white-space: pre;"><a id="L13"></a>&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L14"></a></span><br />
      <span style="white-space: pre;"><a id="L15"></a>import asyncio</span><br />
      <span style="white-space: pre;"><a id="L16"></a>import inspect</span><br />
      <span style="white-space: pre;"><a id="L17"></a>from pathlib import Path</span><br />
      <span style="white-space: pre;"><a id="L18"></a>import sys</span><br />
      <span style="white-space: pre;"><a id="L19"></a>from typing import Optional, Sequence, Tuple, Type, Union</span><br />
      <span style="white-space: pre;"><a id="L20"></a></span><br />
      <span style="white-space: pre;"><a id="L21"></a>from bui.control.exceptions import StopControl</span><br />
      <span style="white-space: pre;"><a id="L22"></a>from bui.control.log import logger as control_logger</span><br />
      <span style="white-space: pre;"><a id="L23"></a>from bui.layout.parser import BUILayoutParser</span><br />
      <span style="white-space: pre;"><a id="L24"></a>from bui.tasks import cancel_all, run_remaining</span><br />
      <span style="white-space: pre;"><a id="L25"></a>from bui.widget.base import Widget</span><br />
      <span style="white-space: pre;"><a id="L26"></a>from bui import widget as wg</span><br />
      <span style="white-space: pre;"><a id="L27"></a></span><br />
      <span style="white-space: pre;"><a id="L28"></a>class MetaWindow(type):</span><br />
      <span style="white-space: pre;"><a id="L29"></a></span><br />
      <span style="white-space: pre;"><a id="L30"></a>    &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L31"></a>    Metaclass for the window class.</span><br />
      <span style="white-space: pre;"><a id="L32"></a></span><br />
      <span style="white-space: pre;"><a id="L33"></a>    It only traces the layout attribute for debugging purposes.</span><br />
      <span style="white-space: pre;"><a id="L34"></a></span><br />
      <span style="white-space: pre;"><a id="L35"></a>    &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L36"></a></span><br />
      <span style="white-space: pre;"><a id="L37"></a>    _marks = {}</span><br />
      <span style="white-space: pre;"><a id="L38"></a></span><br />
      <span style="white-space: pre;"><a id="L39"></a>    def __prepare__(name, bases, **kwargs):</span><br />
      <span style="white-space: pre;"><a id="L40"></a>        namespace = {</span><br />
      <span style="white-space: pre;"><a id="L41"></a>                &quot;mark&quot;: MetaWindow.mark</span><br />
      <span style="white-space: pre;"><a id="L42"></a>        }</span><br />
      <span style="white-space: pre;"><a id="L43"></a></span><br />
      <span style="white-space: pre;"><a id="L44"></a>        # If one of the bases has a `close` method, put it in the namespace</span><br />
      <span style="white-space: pre;"><a id="L45"></a>        for base in bases:</span><br />
      <span style="white-space: pre;"><a id="L46"></a>            close = getattr(base, &quot;close&quot;, None)</span><br />
      <span style="white-space: pre;"><a id="L47"></a>            if close:</span><br />
      <span style="white-space: pre;"><a id="L48"></a>                namespace[&quot;close&quot;] = close</span><br />
      <span style="white-space: pre;"><a id="L49"></a>                namespace[&quot;stop_control&quot;] = base.stop_control</span><br />
      <span style="white-space: pre;"><a id="L50"></a>                break</span><br />
      <span style="white-space: pre;"><a id="L51"></a></span><br />
      <span style="white-space: pre;"><a id="L52"></a>        return namespace</span><br />
      <span style="white-space: pre;"><a id="L53"></a></span><br />
      <span style="white-space: pre;"><a id="L54"></a>    @staticmethod</span><br />
      <span style="white-space: pre;"><a id="L55"></a>    def mark(layout: str) -&gt; str:</span><br />
      <span style="white-space: pre;"><a id="L56"></a>        &quot;&quot;&quot;Mark layout in the window.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L57"></a>        frame = sys._getframe().f_back</span><br />
      <span style="white-space: pre;"><a id="L58"></a>        file = frame.f_globals[&quot;__file__&quot;]</span><br />
      <span style="white-space: pre;"><a id="L59"></a>        line = frame.f_lineno</span><br />
      <span style="white-space: pre;"><a id="L60"></a>        line = line - len(layout.splitlines())</span><br />
      <span style="white-space: pre;"><a id="L61"></a>        qualname = frame.f_locals[&quot;__qualname__&quot;]</span><br />
      <span style="white-space: pre;"><a id="L62"></a>        MetaWindow._marks[qualname] = (file, line)</span><br />
      <span style="white-space: pre;"><a id="L63"></a>        return layout</span><br />
      <span style="white-space: pre;"><a id="L64"></a></span><br />
      <span style="white-space: pre;"><a id="L65"></a></span><br />
      <span style="white-space: pre;"><a id="L66"></a>class Window(Widget, metaclass=MetaWindow):</span><br />
      <span style="white-space: pre;"><a id="L67"></a></span><br />
      <span style="white-space: pre;"><a id="L68"></a>    &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L69"></a>    The Window main class.</span><br />
      <span style="white-space: pre;"><a id="L70"></a></span><br />
      <span style="white-space: pre;"><a id="L71"></a>    Instanciating it (with `Window()`) will attempt to create and return an</span><br />
      <span style="white-space: pre;"><a id="L72"></a>    object of a specific GUI toolkit.  This object will inherit from `Window`</span><br />
      <span style="white-space: pre;"><a id="L73"></a>    and will have the exact same methods and attributes.  You should remain</span><br />
      <span style="white-space: pre;"><a id="L74"></a>    blessfully ignorant of the real class you use.  BUI is designed in such</span><br />
      <span style="white-space: pre;"><a id="L75"></a>    a way that you can ignore how it does its magic for a particular</span><br />
      <span style="white-space: pre;"><a id="L76"></a>    GUI toolkit, except if you&#x27;re coding for such a toolkit.</span><br />
      <span style="white-space: pre;"><a id="L77"></a></span><br />
      <span style="white-space: pre;"><a id="L78"></a>    Class attributes:</span><br />
      <span style="white-space: pre;"><a id="L79"></a>        layout (str, optional): the optional window layout, if it is not</span><br />
      <span style="white-space: pre;"><a id="L80"></a>                defined in a separate [file](../layout/file.md).  It is</span><br />
      <span style="white-space: pre;"><a id="L81"></a>                recommended to not use this class attribute, but you still</span><br />
      <span style="white-space: pre;"><a id="L82"></a>                can do so, if you have your reasons.</span><br />
      <span style="white-space: pre;"><a id="L83"></a>        bui (str, optional): the path leading to the `.bui` file</span><br />
      <span style="white-space: pre;"><a id="L84"></a>                containing your layout.  By default, this is in the same</span><br />
      <span style="white-space: pre;"><a id="L85"></a>                folder and has the same name as the Python file containing</span><br />
      <span style="white-space: pre;"><a id="L86"></a>                your Window class, except it has the `.bui` extension.  If</span><br />
      <span style="white-space: pre;"><a id="L87"></a>                you use this naming convention, you don&#x27;t have to override</span><br />
      <span style="white-space: pre;"><a id="L88"></a>                the `bui` class attribute.  Otherwise, give it a relative</span><br />
      <span style="white-space: pre;"><a id="L89"></a>                or absolute path: absolute paths consider their root to be</span><br />
      <span style="white-space: pre;"><a id="L90"></a>                the user directory when the Python application started</span><br />
      <span style="white-space: pre;"><a id="L91"></a>                (which might not be the same as the directory in which</span><br />
      <span style="white-space: pre;"><a id="L92"></a>                your Python file is contained).</span><br />
      <span style="white-space: pre;"><a id="L93"></a></span><br />
      <span style="white-space: pre;"><a id="L94"></a>    [Controls]../control/overview.md] are defined as methods on this</span><br />
      <span style="white-space: pre;"><a id="L95"></a>    class.  By convention, their name starts with `on_`, like `on_focus` or</span><br />
      <span style="white-space: pre;"><a id="L96"></a>    `on_quit`.  You can also watch for widget controls (execute a method</span><br />
      <span style="white-space: pre;"><a id="L97"></a>    when a button is pressed, for instance).  In this case, you can create</span><br />
      <span style="white-space: pre;"><a id="L98"></a>    `on_{control verb}_{control ID}` like `on_click_button`.  BUI will</span><br />
      <span style="white-space: pre;"><a id="L99"></a>    attempt to connect `on*` methods with controls and will tell you if</span><br />
      <span style="white-space: pre;"><a id="L100"></a>    it fails, or has a doubt.</span><br />
      <span style="white-space: pre;"><a id="L101"></a></span><br />
      <span style="white-space: pre;"><a id="L102"></a>    &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L103"></a></span><br />
      <span style="white-space: pre;"><a id="L104"></a>    widget = &quot;window&quot;</span><br />
      <span style="white-space: pre;"><a id="L105"></a>    class_name = &quot;Window&quot;</span><br />
      <span style="white-space: pre;"><a id="L106"></a>    default_controls = {</span><br />
      <span style="white-space: pre;"><a id="L107"></a>        &quot;close&quot;: &quot;The window is ready to be closed&quot;,</span><br />
      <span style="white-space: pre;"><a id="L108"></a>        &quot;init&quot;: &quot;The window is ready to be displayed&quot;,</span><br />
      <span style="white-space: pre;"><a id="L109"></a>        &quot;press&quot;: &quot;The user presses a key anywhere in the window&quot;,</span><br />
      <span style="white-space: pre;"><a id="L110"></a>        &quot;release&quot;: &quot;The user releases a key anywhere in the window&quot;,</span><br />
      <span style="white-space: pre;"><a id="L111"></a>        &quot;right_click&quot;: &quot;The user right clicks in the window&quot;,</span><br />
      <span style="white-space: pre;"><a id="L112"></a>        &quot;type&quot;: &quot;The user types a character anywhere in the window&quot;,</span><br />
      <span style="white-space: pre;"><a id="L113"></a>    }</span><br />
      <span style="white-space: pre;"><a id="L114"></a></span><br />
      <span style="white-space: pre;"><a id="L115"></a>    # Can be overrideen by subclasses</span><br />
      <span style="white-space: pre;"><a id="L116"></a>    layout = &quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L117"></a>    bui = &quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L118"></a></span><br />
      <span style="white-space: pre;"><a id="L119"></a>    # Class attributes, to be overridden by instance attributes</span><br />
      <span style="white-space: pre;"><a id="L120"></a>    parsed_layout = None</span><br />
      <span style="white-space: pre;"><a id="L121"></a>    _bui_parent = None</span><br />
      <span style="white-space: pre;"><a id="L122"></a></span><br />
      <span style="white-space: pre;"><a id="L123"></a>    def __init__(self, leaf):</span><br />
      <span style="white-space: pre;"><a id="L124"></a>        super().__init__(leaf)</span><br />
      <span style="white-space: pre;"><a id="L125"></a>        self.control_methods = {}</span><br />
      <span style="white-space: pre;"><a id="L126"></a>        self.title = leaf.title</span><br />
      <span style="white-space: pre;"><a id="L127"></a>        self.width = leaf.width</span><br />
      <span style="white-space: pre;"><a id="L128"></a>        self.height = leaf.height</span><br />
      <span style="white-space: pre;"><a id="L129"></a>        self._ids = {}</span><br />
      <span style="white-space: pre;"><a id="L130"></a></span><br />
      <span style="white-space: pre;"><a id="L131"></a>    def __getitem__(self, item):</span><br />
      <span style="white-space: pre;"><a id="L132"></a>        try:</span><br />
      <span style="white-space: pre;"><a id="L133"></a>            return self._ids[item]</span><br />
      <span style="white-space: pre;"><a id="L134"></a>        except KeyError:</span><br />
      <span style="white-space: pre;"><a id="L135"></a>            raise KeyError(f&quot;{item!r} isn&#x27;t a known or valid &quot;</span><br />
      <span style="white-space: pre;"><a id="L136"></a>                    &quot;widget identifier&quot;) from None</span><br />
      <span style="white-space: pre;"><a id="L137"></a></span><br />
      <span style="white-space: pre;"><a id="L138"></a>    @property</span><br />
      <span style="white-space: pre;"><a id="L139"></a>    def usable_surface(self):</span><br />
      <span style="white-space: pre;"><a id="L140"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L141"></a>        Return the screen size that can be used, in pixels.</span><br />
      <span style="white-space: pre;"><a id="L142"></a></span><br />
      <span style="white-space: pre;"><a id="L143"></a>        This size is returned in a tuple: (width, height), so that</span><br />
      <span style="white-space: pre;"><a id="L144"></a>        (x, y) follow the exact same pattern.  Both components are integers.</span><br />
      <span style="white-space: pre;"><a id="L145"></a></span><br />
      <span style="white-space: pre;"><a id="L146"></a>        Note that this is the screen surface being &quot;free&quot;, that is,</span><br />
      <span style="white-space: pre;"><a id="L147"></a>        not counting the taskbar on some operating systems, since</span><br />
      <span style="white-space: pre;"><a id="L148"></a>        we cannot draw on that.  Therefore, the usable surface tends</span><br />
      <span style="white-space: pre;"><a id="L149"></a>        to be somewhat narrower than the screen resolution.</span><br />
      <span style="white-space: pre;"><a id="L150"></a></span><br />
      <span style="white-space: pre;"><a id="L151"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L152"></a>        return self.specific.usable_surface</span><br />
      <span style="white-space: pre;"><a id="L153"></a></span><br />
      <span style="white-space: pre;"><a id="L154"></a>    @classmethod</span><br />
      <span style="white-space: pre;"><a id="L155"></a>    def parse_layout(cls, Window, tag_name=&quot;window&quot;, **kwargs):</span><br />
      <span style="white-space: pre;"><a id="L156"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L157"></a>        Determine where the layout is and try to parse it, return a window.</span><br />
      <span style="white-space: pre;"><a id="L158"></a></span><br />
      <span style="white-space: pre;"><a id="L159"></a>        Raises:</span><br />
      <span style="white-space: pre;"><a id="L160"></a>            ValueError: the layout couldn&#x27;t be parsed.</span><br />
      <span style="white-space: pre;"><a id="L161"></a></span><br />
      <span style="white-space: pre;"><a id="L162"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L163"></a>        if cls.layout:</span><br />
      <span style="white-space: pre;"><a id="L164"></a>            layout = cls.layout</span><br />
      <span style="white-space: pre;"><a id="L165"></a></span><br />
      <span style="white-space: pre;"><a id="L166"></a>            # Try to find the first line and the proper file,</span><br />
      <span style="white-space: pre;"><a id="L167"></a>            # since the layout is defined in code</span><br />
      <span style="white-space: pre;"><a id="L168"></a>            qualname = cls.__qualname__</span><br />
      <span style="white-space: pre;"><a id="L169"></a>            file, line = MetaWindow._marks.get(qualname, (&quot;__unknown__&quot;, 0))</span><br />
      <span style="white-space: pre;"><a id="L170"></a>            parser = BUILayoutParser(file, line)</span><br />
      <span style="white-space: pre;"><a id="L171"></a>        else:</span><br />
      <span style="white-space: pre;"><a id="L172"></a>            bui = cls.bui</span><br />
      <span style="white-space: pre;"><a id="L173"></a>            if not bui:</span><br />
      <span style="white-space: pre;"><a id="L174"></a>                filename = Path(inspect.getsourcefile(cls))</span><br />
      <span style="white-space: pre;"><a id="L175"></a>                if filename.is_absolute():</span><br />
      <span style="white-space: pre;"><a id="L176"></a>                    relative = filename.relative_to(Path().absolute())</span><br />
      <span style="white-space: pre;"><a id="L177"></a>                    bui = f&quot;{relative.parent}/{relative.stem}.bui&quot;</span><br />
      <span style="white-space: pre;"><a id="L178"></a>                else:</span><br />
      <span style="white-space: pre;"><a id="L179"></a>                    bui = f&quot;{filename.parent}/{filename.stem}.bui&quot;</span><br />
      <span style="white-space: pre;"><a id="L180"></a></span><br />
      <span style="white-space: pre;"><a id="L181"></a>            with open(bui, &#x27;r&#x27;, encoding=&quot;utf-8&quot;) as file:</span><br />
      <span style="white-space: pre;"><a id="L182"></a>                layout = file.read()</span><br />
      <span style="white-space: pre;"><a id="L183"></a></span><br />
      <span style="white-space: pre;"><a id="L184"></a>            parser = BUILayoutParser(bui)</span><br />
      <span style="white-space: pre;"><a id="L185"></a></span><br />
      <span style="white-space: pre;"><a id="L186"></a>        parser.feed(layout)</span><br />
      <span style="white-space: pre;"><a id="L187"></a>        parsed_layout = parser.layout</span><br />
      <span style="white-space: pre;"><a id="L188"></a>        window_leaf = parsed_layout.get(tag_name)</span><br />
      <span style="white-space: pre;"><a id="L189"></a>        if window_leaf is None:</span><br />
      <span style="white-space: pre;"><a id="L190"></a>            raise ValueError(&quot;the specified layout doesn&#x27;t contain a &lt;window&gt; description&quot;)</span><br />
      <span style="white-space: pre;"><a id="L191"></a></span><br />
      <span style="white-space: pre;"><a id="L192"></a>        # Creates all the leafs</span><br />
      <span style="white-space: pre;"><a id="L193"></a>        from bui.widget import WIDGETS</span><br />
      <span style="white-space: pre;"><a id="L194"></a>        widgets = []</span><br />
      <span style="white-space: pre;"><a id="L195"></a>        ids = {}</span><br />
      <span style="white-space: pre;"><a id="L196"></a>        for leaf in parsed_layout.flat:</span><br />
      <span style="white-space: pre;"><a id="L197"></a>            leaf.complete()</span><br />
      <span style="white-space: pre;"><a id="L198"></a>            if not leaf.has_widget:</span><br />
      <span style="white-space: pre;"><a id="L199"></a>                continue</span><br />
      <span style="white-space: pre;"><a id="L200"></a>            elif leaf is window_leaf:</span><br />
      <span style="white-space: pre;"><a id="L201"></a>                Generic = Window</span><br />
      <span style="white-space: pre;"><a id="L202"></a>            else:</span><br />
      <span style="white-space: pre;"><a id="L203"></a>                Generic = WIDGETS[leaf.tag_name]</span><br />
      <span style="white-space: pre;"><a id="L204"></a></span><br />
      <span style="white-space: pre;"><a id="L205"></a>            widget = Generic(leaf)</span><br />
      <span style="white-space: pre;"><a id="L206"></a>            if leaf is window_leaf:</span><br />
      <span style="white-space: pre;"><a id="L207"></a>                for key, value in kwargs.items():</span><br />
      <span style="white-space: pre;"><a id="L208"></a>                    setattr(widget, key, value)</span><br />
      <span style="white-space: pre;"><a id="L209"></a></span><br />
      <span style="white-space: pre;"><a id="L210"></a>            leaf.widget = widget</span><br />
      <span style="white-space: pre;"><a id="L211"></a>            widget.create_specific()</span><br />
      <span style="white-space: pre;"><a id="L212"></a>            widgets.append(widget)</span><br />
      <span style="white-space: pre;"><a id="L213"></a>            if leaf is window_leaf:</span><br />
      <span style="white-space: pre;"><a id="L214"></a>                window = widget</span><br />
      <span style="white-space: pre;"><a id="L215"></a></span><br />
      <span style="white-space: pre;"><a id="L216"></a>            widget_id = getattr(widget, &quot;id&quot;, None)</span><br />
      <span style="white-space: pre;"><a id="L217"></a>            if widget_id:</span><br />
      <span style="white-space: pre;"><a id="L218"></a>                ids[widget_id] = widget</span><br />
      <span style="white-space: pre;"><a id="L219"></a></span><br />
      <span style="white-space: pre;"><a id="L220"></a>        window._ids = ids</span><br />
      <span style="white-space: pre;"><a id="L221"></a></span><br />
      <span style="white-space: pre;"><a id="L222"></a>        # Call the `_init` method on all generic widgets</span><br />
      <span style="white-space: pre;"><a id="L223"></a>        control_logger.debug(&quot;  Binding control methods...&quot;)</span><br />
      <span style="white-space: pre;"><a id="L224"></a></span><br />
      <span style="white-space: pre;"><a id="L225"></a>        for widget in widgets:</span><br />
      <span style="white-space: pre;"><a id="L226"></a>            widget._bind_controls(window)</span><br />
      <span style="white-space: pre;"><a id="L227"></a>            widget._init()</span><br />
      <span style="white-space: pre;"><a id="L228"></a></span><br />
      <span style="white-space: pre;"><a id="L229"></a>        window.parsed_layout = parsed_layout</span><br />
      <span style="white-space: pre;"><a id="L230"></a>        for widget in widgets:</span><br />
      <span style="white-space: pre;"><a id="L231"></a>            widget.specific.process_control(None, &quot;init&quot;)</span><br />
      <span style="white-space: pre;"><a id="L232"></a></span><br />
      <span style="white-space: pre;"><a id="L233"></a>        return window</span><br />
      <span style="white-space: pre;"><a id="L234"></a></span><br />
      <span style="white-space: pre;"><a id="L235"></a>    def _init(self):</span><br />
      <span style="white-space: pre;"><a id="L236"></a>        &quot;&quot;&quot;Private method to initialize the generic and specific window.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L237"></a>        self.specific._init()</span><br />
      <span style="white-space: pre;"><a id="L238"></a></span><br />
      <span style="white-space: pre;"><a id="L239"></a>    def _start(self, loop):</span><br />
      <span style="white-space: pre;"><a id="L240"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L241"></a>        Start the window, watch events and allow async loop.</span><br />
      <span style="white-space: pre;"><a id="L242"></a></span><br />
      <span style="white-space: pre;"><a id="L243"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L244"></a>            loop (AsyncLoop): the asynchronous event loop (see asyncio).</span><br />
      <span style="white-space: pre;"><a id="L245"></a></span><br />
      <span style="white-space: pre;"><a id="L246"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L247"></a>        self.specific.show()</span><br />
      <span style="white-space: pre;"><a id="L248"></a>        return self.specific._start(loop)</span><br />
      <span style="white-space: pre;"><a id="L249"></a></span><br />
      <span style="white-space: pre;"><a id="L250"></a>    async def _stop(self):</span><br />
      <span style="white-space: pre;"><a id="L251"></a>        &quot;&quot;&quot;Stop the window toolkit.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L252"></a>        cancel_all()</span><br />
      <span style="white-space: pre;"><a id="L253"></a>        self.specific.process_control(None, &quot;close&quot;, close=True)</span><br />
      <span style="white-space: pre;"><a id="L254"></a>        self.close()</span><br />
      <span style="white-space: pre;"><a id="L255"></a></span><br />
      <span style="white-space: pre;"><a id="L256"></a>    def close(self):</span><br />
      <span style="white-space: pre;"><a id="L257"></a>        &quot;&quot;&quot;Close this window.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L258"></a>        self.specific.close()</span><br />
      <span style="white-space: pre;"><a id="L259"></a></span><br />
      <span style="white-space: pre;"><a id="L260"></a>    def stop_control(self):</span><br />
      <span style="white-space: pre;"><a id="L261"></a>        &quot;&quot;&quot;Stop the control, and the control method that called it.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L262"></a>        raise StopControl()</span><br />
      <span style="white-space: pre;"><a id="L263"></a></span><br />
      <span style="white-space: pre;"><a id="L264"></a>    def pop_open_file(self, message: str, location: Path = None,</span><br />
      <span style="white-space: pre;"><a id="L265"></a>            filters: Sequence[Union[str, Tuple[str, str]]] = (),</span><br />
      <span style="white-space: pre;"><a id="L266"></a>            default: str = None, multiple: bool = False,</span><br />
      <span style="white-space: pre;"><a id="L267"></a>            preview: bool = True, hidden: bool = False</span><br />
      <span style="white-space: pre;"><a id="L268"></a>            ) -&gt; Optional[Union[Path, Tuple[Path]]]:</span><br />
      <span style="white-space: pre;"><a id="L269"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L270"></a>        Display a system dialog to select one or several files.</span><br />
      <span style="white-space: pre;"><a id="L271"></a></span><br />
      <span style="white-space: pre;"><a id="L272"></a>        This method displays a file system dialog, where the user can browse directories and select one or several files.  The selected file(s) will be returned if the user presses on the &#x27;open&#x27; button in the dialog.  You can catch the result of this dialog to perform whatever operation you need.</span><br />
      <span style="white-space: pre;"><a id="L273"></a></span><br />
      <span style="white-space: pre;"><a id="L274"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L275"></a>            message (str): the message to display to the user.</span><br />
      <span style="white-space: pre;"><a id="L276"></a>            location (Path, optional): if not set, use the current</span><br />
      <span style="white-space: pre;"><a id="L277"></a>                    directory.  Otherwise, you need to specify a</span><br />
      <span style="white-space: pre;"><a id="L278"></a>                    `pathlib.Path` object.</span><br />
      <span style="white-space: pre;"><a id="L279"></a>            filters (sequence): a sequence of filters to apply to the file</span><br />
      <span style="white-space: pre;"><a id="L280"></a>                    system list.  Each filter can be a string containing,</span><br />
      <span style="white-space: pre;"><a id="L281"></a>                    between parenthesis, the pattern to apply.  Optionally</span><br />
      <span style="white-space: pre;"><a id="L282"></a>                    a filter can be a tuple of two information:</span><br />
      <span style="white-space: pre;"><a id="L283"></a>                    the pattern, and what to display to the user.  See</span><br />
      <span style="white-space: pre;"><a id="L284"></a>                    the examples below of valid filters.</span><br />
      <span style="white-space: pre;"><a id="L285"></a>            default (str, optional): the default (selected) file, if any.</span><br />
      <span style="white-space: pre;"><a id="L286"></a>            multiple (bool, optional): allow to select several files</span><br />
      <span style="white-space: pre;"><a id="L287"></a>                    (default False).</span><br />
      <span style="white-space: pre;"><a id="L288"></a>            preview (bool, optional): display a previoew of the file (default</span><br />
      <span style="white-space: pre;"><a id="L289"></a>                    True).</span><br />
      <span style="white-space: pre;"><a id="L290"></a>            hidden (bool, optional): display hidden files (default False).</span><br />
      <span style="white-space: pre;"><a id="L291"></a></span><br />
      <span style="white-space: pre;"><a id="L292"></a>        Returns:</span><br />
      <span style="white-space: pre;"><a id="L293"></a>            If `multiple` is not set, returns either `None` or the</span><br />
      <span style="white-space: pre;"><a id="L294"></a>            selected file, as a `pathlib.Path` object.</span><br />
      <span style="white-space: pre;"><a id="L295"></a>            If `multiple` is set to `True`, returns either an empty tuple,</span><br />
      <span style="white-space: pre;"><a id="L296"></a>            or a tuple of selected files, where each file is a</span><br />
      <span style="white-space: pre;"><a id="L297"></a>            `pathlib.Path` object.</span><br />
      <span style="white-space: pre;"><a id="L298"></a>            Returning `None` or an empty tuple indicates the user</span><br />
      <span style="white-space: pre;"><a id="L299"></a>            cancelled the operation (pressed on the Cancel button in</span><br />
      <span style="white-space: pre;"><a id="L300"></a>            the file system dialog).</span><br />
      <span style="white-space: pre;"><a id="L301"></a></span><br />
      <span style="white-space: pre;"><a id="L302"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L303"></a></span><br />
      <span style="white-space: pre;"><a id="L304"></a></span><br />
      <span style="white-space: pre;"><a id="L305"></a></span><br />
      <span style="white-space: pre;"><a id="L306"></a>    async def pop_alert(self, title: str, message: str,</span><br />
      <span style="white-space: pre;"><a id="L307"></a>            danger: Optional[str] = &quot;error&quot;,</span><br />
      <span style="white-space: pre;"><a id="L308"></a>            ok: Optional[Union[bool, str]] = True,</span><br />
      <span style="white-space: pre;"><a id="L309"></a>            cancel: Optional[Union[bool, str]] = False,</span><br />
      <span style="white-space: pre;"><a id="L310"></a>            yes: Optional[Union[bool, str]] = False,</span><br />
      <span style="white-space: pre;"><a id="L311"></a>            no: Optional[Union[bool, str]] = False,</span><br />
      <span style="white-space: pre;"><a id="L312"></a>            default: Optional[str] = &quot;ok&quot;):</span><br />
      <span style="white-space: pre;"><a id="L313"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L314"></a>        Display a default message box for inforiation or errors.</span><br />
      <span style="white-space: pre;"><a id="L315"></a></span><br />
      <span style="white-space: pre;"><a id="L316"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L317"></a>            title (str): the dialog title.</span><br />
      <span style="white-space: pre;"><a id="L318"></a>            message (str): the message title, can be on several lines.</span><br />
      <span style="white-space: pre;"><a id="L319"></a>            danger (str): the type of the dialog which will influence</span><br />
      <span style="white-space: pre;"><a id="L320"></a>                    how noisy it is, what icon it displays and so on.</span><br />
      <span style="white-space: pre;"><a id="L321"></a>                    Possible values are:</span><br />
      <span style="white-space: pre;"><a id="L322"></a>                    &quot;info&quot;: informative dialog, just to be polite.</span><br />
      <span style="white-space: pre;"><a id="L323"></a>                    &quot;warning&quot;: warning message, danger increases.</span><br />
      <span style="white-space: pre;"><a id="L324"></a>                    &quot;error&quot;: error message, probably can&#x27;t go on.</span><br />
      <span style="white-space: pre;"><a id="L325"></a>                    &quot;quesiton&quot;: just a question to ask the user.</span><br />
      <span style="white-space: pre;"><a id="L326"></a>            ok (bool or str, optional): should a OK butotn appear?</span><br />
      <span style="white-space: pre;"><a id="L327"></a>            cancel (bool or str, optional): should a cancel button appear?</span><br />
      <span style="white-space: pre;"><a id="L328"></a>            yes (bool or str, optional): should a yes butotn appear?</span><br />
      <span style="white-space: pre;"><a id="L329"></a>            no (bool or str, optional): should a no butotn appear?</span><br />
      <span style="white-space: pre;"><a id="L330"></a>            default (str, optional): the name of the default button.</span><br />
      <span style="white-space: pre;"><a id="L331"></a></span><br />
      <span style="white-space: pre;"><a id="L332"></a>        The button can either be set to True (only ok is set to True</span><br />
      <span style="white-space: pre;"><a id="L333"></a>        by default), or contain a string of the button label to display.  A button with False will not appear.  For isntance:</span><br />
      <span style="white-space: pre;"><a id="L334"></a></span><br />
      <span style="white-space: pre;"><a id="L335"></a>            answer = await self.pop_alert(..., danger=&quot;question&quot;,</span><br />
      <span style="white-space: pre;"><a id="L336"></a>                    ok=&quot;Go on anyway&quot;, cancel=&quot;Don&#x27;t even try&quot;)</span><br />
      <span style="white-space: pre;"><a id="L337"></a>            if answer == &quot;ok&quot;:</span><br />
      <span style="white-space: pre;"><a id="L338"></a>                # Go on</span><br />
      <span style="white-space: pre;"><a id="L339"></a></span><br />
      <span style="white-space: pre;"><a id="L340"></a>        Returns:</span><br />
      <span style="white-space: pre;"><a id="L341"></a>            clicked button (str): the clicked button as a string,</span><br />
      <span style="white-space: pre;"><a id="L342"></a>                    either &quot;ok&quot;, &quot;cancel&quot;, &quot;yes&quot;, &quot;no&quot;.</span><br />
      <span style="white-space: pre;"><a id="L343"></a>                    Even if a different label has been set for these</span><br />
      <span style="white-space: pre;"><a id="L344"></a>                    buttons, the string identifiers do not change.</span><br />
      <span style="white-space: pre;"><a id="L345"></a></span><br />
      <span style="white-space: pre;"><a id="L346"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L347"></a>        buttons = {}</span><br />
      <span style="white-space: pre;"><a id="L348"></a>        if ok: buttons[&quot;ok&quot;] = ok</span><br />
      <span style="white-space: pre;"><a id="L349"></a>        if cancel: buttons[&quot;cancel&quot;] = cancel</span><br />
      <span style="white-space: pre;"><a id="L350"></a>        if yes: buttons[&quot;yes&quot;] = yes</span><br />
      <span style="white-space: pre;"><a id="L351"></a>        if no: buttons[&quot;no&quot;] = no</span><br />
      <span style="white-space: pre;"><a id="L352"></a>        if default not in buttons.keys():</span><br />
      <span style="white-space: pre;"><a id="L353"></a>            raise ValueError(f&quot;{default!r} isn&#x27;t in this alert box buttons&quot;)</span><br />
      <span style="white-space: pre;"><a id="L354"></a></span><br />
      <span style="white-space: pre;"><a id="L355"></a>        return await self.specific.pop_alert(title=title, message=message,</span><br />
      <span style="white-space: pre;"><a id="L356"></a>                danger=danger, buttons=buttons, default=default)</span><br />
      <span style="white-space: pre;"><a id="L357"></a></span><br />
      <span style="white-space: pre;"><a id="L358"></a>    async def pop_dialog(self, dialog: Union[str, Type[&#x27;wg.dialog.Dialog&#x27;]],</span><br />
      <span style="white-space: pre;"><a id="L359"></a>            **kwargs) -&gt; &#x27;wg.dialog.Dialog&#x27;:</span><br />
      <span style="white-space: pre;"><a id="L360"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L361"></a>        Pop up a custom dialog, blocks until the dialog has been closed.</span><br />
      <span style="white-space: pre;"><a id="L362"></a></span><br />
      <span style="white-space: pre;"><a id="L363"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L364"></a>            dialog (str or Dialog): the dialog layout (as a str) or the</span><br />
      <span style="white-space: pre;"><a id="L365"></a>                    Dialog class to instantiate from.</span><br />
      <span style="white-space: pre;"><a id="L366"></a></span><br />
      <span style="white-space: pre;"><a id="L367"></a>        Returns:</span><br />
      <span style="white-space: pre;"><a id="L368"></a>            dialog (Dialog): the dialog object.  This object could</span><br />
      <span style="white-space: pre;"><a id="L369"></a>                    contain &quot;filled&quot; information by the user.</span><br />
      <span style="white-space: pre;"><a id="L370"></a></span><br />
      <span style="white-space: pre;"><a id="L371"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L372"></a>        from bui.widget.dialog import Dialog</span><br />
      <span style="white-space: pre;"><a id="L373"></a>        if isinstance(dialog, str):</span><br />
      <span style="white-space: pre;"><a id="L374"></a>            class NewDialog(Dialog):</span><br />
      <span style="white-space: pre;"><a id="L375"></a>                layout = mark(dialog)</span><br />
      <span style="white-space: pre;"><a id="L376"></a>            dialog = NewDialog</span><br />
      <span style="white-space: pre;"><a id="L377"></a>        assert issubclass(dialog, wg.dialog.Dialog)</span><br />
      <span style="white-space: pre;"><a id="L378"></a>        dialog.window = self</span><br />
      <span style="white-space: pre;"><a id="L379"></a>        return await self.specific.pop_dialog(dialog, **kwargs)</span><br />
      <span style="white-space: pre;"><a id="L380"></a></span><br />
      <span style="white-space: pre;"><a id="L381"></a>    def pop_menu(self, context_id: str):</span><br />
      <span style="white-space: pre;"><a id="L382"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L383"></a>        Pop a context menu, blocks until the menu is closed.</span><br />
      <span style="white-space: pre;"><a id="L384"></a></span><br />
      <span style="white-space: pre;"><a id="L385"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L386"></a>            context_id (str): the registered ID of the context menu.</span><br />
      <span style="white-space: pre;"><a id="L387"></a></span><br />
      <span style="white-space: pre;"><a id="L388"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L389"></a>        context = self[context_id]</span><br />
      <span style="white-space: pre;"><a id="L390"></a>        self.specific.pop_menu(context.specific)</span><br />
      <span style="white-space: pre;"><a id="L391"></a></span><br />
      <span style="white-space: pre;"><a id="L392"></a>    def open_window(self, window: &quot;Window&quot;, child=False):</span><br />
      <span style="white-space: pre;"><a id="L393"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L394"></a>        Open a new window.</span><br />
      <span style="white-space: pre;"><a id="L395"></a></span><br />
      <span style="white-space: pre;"><a id="L396"></a>        Args:</span><br />
      <span style="white-space: pre;"><a id="L397"></a>            window (Window): the window class.</span><br />
      <span style="white-space: pre;"><a id="L398"></a>            child (bool): if True, the new window will be a child of the</span><br />
      <span style="white-space: pre;"><a id="L399"></a>                    current window (closing self will close the new window).</span><br />
      <span style="white-space: pre;"><a id="L400"></a></span><br />
      <span style="white-space: pre;"><a id="L401"></a>        &quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L402"></a>        if child:</span><br />
      <span style="white-space: pre;"><a id="L403"></a>            window._bui_parent = self</span><br />
      <span style="white-space: pre;"><a id="L404"></a></span><br />
      <span style="white-space: pre;"><a id="L405"></a>        self.specific.open_window(window, child=child)</span><br />
      <span style="white-space: pre;"><a id="L406"></a>        return window</span><br />
      <span style="white-space: pre;"><a id="L407"></a></span><br />
      <span style="white-space: pre;"><a id="L408"></a>    def handle_close(self, control):</span><br />
      <span style="white-space: pre;"><a id="L409"></a>        &quot;&quot;&quot;The window closes.&quot;&quot;&quot;</span><br />
      <span style="white-space: pre;"><a id="L410"></a>        pass</span><br />
    </div>
  </body>
</html>